name: ðŸ¤– Code Quality (Bugbot)

on:
  push:
    branches: [ main, master, develop, feat/**, fix/** ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint-and-validate:
    name: ðŸ” Lint & Validate
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“¦ Install dependencies
        run: npm ci

      - name: ðŸŽ¨ Check code formatting
        run: npm run format:check
        continue-on-error: true

      - name: ðŸ” Lint TypeScript
        run: npm run lint
        continue-on-error: false

      - name: ðŸ§ª Validate test files
        run: |
          echo "ðŸ” Validating test files can be compiled..."
          npx tsc --noEmit
        continue-on-error: false

      - name: ðŸ“‹ List available tests
        run: |
          echo "ðŸ“‹ Checking if tests can be discovered..."
          npx playwright test --list || exit 1

      - name: âœ… Validate workflow files
        run: |
          echo "âœ… Validating GitHub Actions workflows..."
          # Check for common issues in workflow files
          if grep -r "reporter=.*,.*,.*" .github/workflows/; then
            echo "âŒ ERROR: Found incorrect reporter syntax in workflows!"
            echo "Use '--reporter=html --reporter=json' instead of '--reporter=html,json'"
            exit 1
          fi
          echo "âœ… Workflow files validated"

      - name: ðŸ“Š Summary
        if: always()
        run: |
          echo "## ðŸ¤– Bugbot Code Quality Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All quality checks completed!" >> $GITHUB_STEP_SUMMARY



